# NY.gov Comprehensive Vulnerability Report

**Audit Date:** January 3, 2026  
**Auditor:** Brian Sanders  
**Classification:** OFFICIAL - SECURITY SENSITIVE

---

## Executive Summary

This report documents **8 confirmed vulnerabilities** across NY.gov systems, prioritized by risk severity. The findings range from critical system failures blocking all user registrations to low-severity information disclosure issues.

| Priority | Severity | Vulnerability | CVSS Est. |
|----------|----------|---------------|-----------|
| 1 | **CRITICAL** | Session ID in URL (GovQA) | 9.1 |
| 2 | **CRITICAL** | SSN Field Rendering Failure | 8.5 |
| 3 | **HIGH** | User/Email Enumeration | 7.5 |
| 4 | **HIGH** | CAPTCHA Invisibility | 7.0 |
| 5 | **MEDIUM** | Clickjacking Vulnerability | 6.1 |
| 6 | **MEDIUM** | Resource Loading Failures | 5.5 |
| 7 | **LOW** | Missing Security Headers | 4.0 |
| 8 | **LOW** | Build Information Disclosure | 3.0 |

---

## CRITICAL VULNERABILITIES

### 1. Session ID in URL (GovQA FOIL Portal)

**Severity:** CRITICAL (CVSS 9.1)  
**System:** itsny.govqa.us  
**CWE:** CWE-384 (Session Fixation), CWE-200 (Information Exposure)

#### Description
The GovQA FOIL portal embeds session identifiers directly in the URL path:

```
https://itsny.govqa.us/WEBAPP/_rs/(S(k1jzg2ix2y4p5v42v42v42v4))/RequestLogin.aspx
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                  SESSION TOKEN EXPOSED IN URL
```

#### Attack Scenario
1. User logs into FOIL portal
2. User clicks external link or shares their URL
3. Session token leaks via `Referer` HTTP header
4. Attacker uses token to hijack session
5. Attacker accesses user's FOIL requests and personal data

#### Evidence
```javascript
// URL contains session pattern
/S\([a-z0-9]+\)/i.test(location.href)  // Returns: true
```

#### Impact
- **Session Hijacking:** Complete account takeover
- **Data Exposure:** Access to pending FOIL requests with personal info
- **Impersonation:** Submit/withdraw requests as victim

#### Recommendation
- **Immediate:** Configure server to use HTTP-only cookies for session management
- **Short-term:** Regenerate session tokens after authentication
- **Long-term:** Implement proper session fixation protections

---

### 2. SSN Field Rendering Failure (SelfRegV3)

**Severity:** CRITICAL (CVSS 8.5)  
**System:** my.ny.gov/SelfRegV3  
**CWE:** CWE-404 (Improper Resource Shutdown)

#### Description
The Social Security Number input field fails to render on the registration form, leaving an empty DOM container:

```html
<span id="selfregform:ssnPanel"></span>
<!-- Expected: <input type="text" class="ssnId" ...> -->
<!-- Actual: EMPTY -->
```

#### Evidence
```javascript
document.getElementById('selfregform:ssnPanel').innerHTML.trim() === ''
// Returns: true

document.querySelector('.ssnId')
// Returns: null
```

#### Impact
- **Total Service Denial:** 100% of new registrations fail
- **Healthcare Access Blocked:** Users cannot enroll in NY State of Health
- **Benefits Inaccessible:** DMV, tax, and other services unavailable to new users

#### Root Cause
- Server-side JSF/PrimeFaces rendering failure
- Build metadata shows `W: (NULL)` indicating null configuration
- Resource loading failures prevent component initialization

#### Recommendation
- **Emergency:** Deploy server-side patch to render SSN component
- **Fallback:** Implement client-side detection and user notification
- **Monitoring:** Add synthetic checks for form field rendering

---

## HIGH SEVERITY VULNERABILITIES

### 3. User/Email Enumeration

**Severity:** HIGH (CVSS 7.5)  
**System:** my.ny.gov/SelfRegV3  
**CWE:** CWE-203 (Observable Discrepancy)

#### Description
The registration form reveals whether usernames and email addresses are already registered with specific error messages.

#### Evidence
**Username enumeration:**
```
Input: admin
Response: "The Username you have selected is currently in use."
```

**Email enumeration:**
```
Input: known.user@example.com
Response: "You already have an NY.gov ID!"
```

#### Attack Scenario
1. Attacker scripts automated requests with common usernames
2. System reveals which usernames exist
3. Attacker builds database of valid accounts
4. Database used for credential stuffing or phishing

#### Impact
- **Account Discovery:** Enumerate valid user accounts
- **Targeted Attacks:** Phishing campaigns against confirmed users
- **Credential Stuffing:** Focus attacks on known-valid accounts

#### Recommendation
- **Immediate:** Generic error messages for all cases
- **Example:** "If this email is registered, you'll receive instructions."
- **Rate Limiting:** Block excessive enumeration attempts

---

### 4. CAPTCHA Invisibility (GovQA)

**Severity:** HIGH (CVSS 7.0)  
**System:** itsny.govqa.us  
**CWE:** CWE-451 (UI Misrepresentation)

#### Description
BotDetect CAPTCHA images render with 0x0 pixel dimensions due to CSS layout collapse.

#### Evidence
```javascript
captchaImg.offsetWidth  // 0
captchaImg.offsetHeight // 0
```

#### Impact
- **FOIL Denial:** Citizens cannot submit public records requests
- **Registration Blocked:** Account creation on FOIL portal fails
- **Accessibility Violation:** Effectively breaks required functionality

#### Recommendation
- **CSS Fix:** Set minimum dimensions on CAPTCHA containers
```css
.BotDetect { min-width: 200px !important; min-height: 50px !important; }
```

---

## MEDIUM SEVERITY VULNERABILITIES

### 5. Clickjacking Vulnerability

**Severity:** MEDIUM (CVSS 6.1)  
**System:** All NY.gov properties  
**CWE:** CWE-1021 (Improper Restriction of Rendered UI Layers)

#### Description
Neither NY.gov nor GovQA implement frame protection headers.

#### Evidence
```javascript
document.querySelector('meta[http-equiv="X-Frame-Options"]')
// Returns: null

document.querySelector('meta[http-equiv="Content-Security-Policy"]')
// Returns: null
```

#### Attack Scenario
1. Attacker creates malicious website
2. Embeds NY.gov login in transparent iframe
3. Overlays fake UI elements
4. User clicks "login" but actually submits to attacker

#### Recommendation
```
X-Frame-Options: DENY
Content-Security-Policy: frame-ancestors 'none';
```

---

### 6. Resource Loading Failures

**Severity:** MEDIUM (CVSS 5.5)  
**System:** my.ny.gov/SelfRegV3  
**CWE:** CWE-1104 (Use of Unmaintained Third Party Components)

#### Description
Core JavaScript and CSS resources fail to load from `/javax.faces.resource/`.

#### Failed Resources
- `jquery.js.xhtml`
- `primeicons.css.xhtml`
- `jquery.maskssn.js`
- `selfreg-custom-ui.js`

#### Impact
- UI components fail to initialize
- Form validation doesn't work
- SSN masking unavailable (contributes to Finding #2)

#### Recommendation
- Check WAF/CDN configuration
- Verify `/javax.faces.resource/` URL mapping
- Monitor resource availability

---

## LOW SEVERITY VULNERABILITIES

### 7. Missing Security Headers

**Severity:** LOW (CVSS 4.0)  
**System:** All NY.gov properties  
**CWE:** CWE-693 (Protection Mechanism Failure)

#### Missing Headers
| Header | Status | Risk |
|--------|--------|------|
| Strict-Transport-Security | MISSING | MITM downgrade |
| X-Content-Type-Options | MISSING | MIME sniffing |
| Content-Security-Policy | MISSING | XSS protection |
| Referrer-Policy | MISSING | Data leakage |
| Permissions-Policy | MISSING | Feature abuse |

#### Recommended Configuration
```
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
X-Content-Type-Options: nosniff
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' https://www.google.com/recaptcha/; 
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), camera=(), microphone=()
```

---

### 8. Build Information Disclosure

**Severity:** LOW (CVSS 3.0)  
**System:** my.ny.gov/SelfRegV3  
**CWE:** CWE-200 (Information Exposure)

#### Evidence
Page footer contains:
```
Build: 12/05/2025 9:11 PM W: (NULL) A: 169PB_1
```

#### Risk
- Reveals deployment timestamps
- Helps attackers identify unpatched versions
- `W: (NULL)` may indicate configuration issues

#### Recommendation
- Remove build info from production
- Use build IDs that don't reveal timing

---

## Audit Methodology

### Tests Performed
- [x] SQL Injection testing (login, registration)
- [x] XSS testing (reflected, stored)
- [x] Authentication bypass attempts
- [x] Session management analysis
- [x] IDOR testing on FAQ pages
- [x] CSRF token verification
- [x] Clickjacking assessment
- [x] Sensitive data in source code
- [x] Error handling analysis
- [x] Security headers audit
- [x] Form security analysis
- [x] Admin path enumeration

### Tools Used
- Browser DevTools
- Custom JavaScript audit scripts
- Network performance API
- DOM inspection

### Pages Tested
1. `https://my.ny.gov` - Main portal
2. `https://my.ny.gov/LoginV4/login.xhtml` - Login page
3. `https://my.ny.gov/SelfRegV3/selfregstepone.xhtml` - Registration Step 1
4. `https://my.ny.gov/SelfRegV3/selfregsteptwo.xhtml` - Registration Step 2
5. `https://my.ny.gov/SelfRegV3/selfregblocked.xhtml` - Error page
6. `https://itsny.govqa.us` - FOIL portal

---

## Remediation Priority Matrix

| Priority | Vulnerability | Fix Complexity | Business Impact |
|----------|---------------|----------------|-----------------|
| **P1** | Session in URL | Medium | Critical |
| **P1** | SSN Rendering | Medium | Critical |
| **P2** | User Enumeration | Low | High |
| **P2** | CAPTCHA Invisible | Low | High |
| **P3** | Clickjacking | Low | Medium |
| **P3** | Resource Loading | Medium | Medium |
| **P4** | Security Headers | Low | Low |
| **P4** | Build Disclosure | Low | Low |

---

## Contact

**Security Researcher:** Brian Sanders  
**Email:** shaqsanders73@gmail.com  
**GitHub:** https://github.com/barkleesanders  

**Related Documentation:**
- Fix Repository: https://github.com/barkleesanders/nygov-selfreg-fix
- FOIL Request: R000252-010326

---

## Disclosure Timeline

| Date | Event |
|------|-------|
| 2026-01-03 | Vulnerabilities discovered |
| 2026-01-03 | Root cause analysis completed |
| 2026-01-03 | Workarounds developed |
| 2026-01-03 | FOIL request submitted |
| 2026-01-03 | Security report prepared |
| 2026-01-03 | Submitted to CISO@its.ny.gov |
